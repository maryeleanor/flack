{% extends "layout.html" %}

{% block body %}
    <script>
        var room = `{{ room }}`;
        var username = `{{ username|e }}`; 
        localStorage.setItem('room', room);  
        localStorage.setItem('username', username);
    </script>

    <main role="main" class="container">
        <div class="row">
        <div class="col-md-9">
                                
            {% if not username %}
            <h2 class="m-2"> Welcome to Flack</h2>
            <h6 class="m-2"><i> a chat app like slack built with flask </i></h6>
            
            <div class="m-5"> </div>   
            
            <h5 class="m-2"> Select a channel and enter a username to get started: </h5>
            
            <form action="/" method="post" class="m-2 login">
            
                <div class="m-4 form-group"> </div>  

                    <div class="form-group">
                        <select class="form-control btn" name="room" autofocus aria-haspopup="true" aria-expanded="false"> 
                            <option class="dropdown-item" id="dropdown" disabled="" selected="" value="">Select a Channel</option>
                            {% for room in rooms %}
                                    <option id="room"> {{ room|title }} </option>
                            {% endfor %}
                        </select>
                    </div>
                        
                <div class="m-2 form-group"> </div>

                <div class="form-group">
                    <input id="username" autocomplete="off" class="form-control" name="username" placeholder="Username" type="text">
                </div>

                <div class="m-2 form-group"> </div>

                <div class="form-group">
                <button id="submit" class="btn btn-info" type="submit" disabled >Register</button>
                </div>

            </form>
            
            <div class="m-5"> </div>

            <script>
            
            document.addEventListener('DOMContentLoaded', () => {
                
                var username = document.querySelector('#username');
                username.addEventListener("keyup", submitFunction);
                document.addEventListener('click', submitFunction);
                document.addEventListener('keyup', submitFunction);
                
                function submitFunction() {
                        if (username.value === ''){
                            document.querySelector('#submit').disabled = true;
                        }
                        else {
                            document.querySelector('#submit').disabled = false;
                        }
                };

            });

            </script>  

            {% endif %}  

            {% if error %} 
                {{ error }}
                
            {% endif %}

            {% if username %}  
             
            <div class="m-3"> </div>


            <div id="chatroom">
            {% for message in messages[room] %}
                <p>
                <span class="date">{{ message['timestamp'] }}</span>
                <span class="username">{{ message['username'] }}</span>
                {{ message['msg'] }} {{ message['room'] }}
                </p>
            {% endfor %}  

            </div> 

            <div class="m-3"> </div>

            <div id="form" class="chatbox">
                    <input autocomplete="off" autofocus id="chat" class=" " placeholder=" ..." type="text">
                    <button class="btn btn-info" id="send_chat">send</button>
            </div>
            
            <div class="m-2"> </div>

    
            </div>
            <div class="col-md-3">
                <div class="content-section">
                    <h3>Channels</h3> 
                        <ul class="list-group">
                            {% for room in rooms %}
                                <li class="list-group-item select_room">{{ room|title }}</li>
                            {% endfor %}
                            <!-- Button trigger modal -->
                            <li class="list-group-item select_room" type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal"> Create new channel </li>
                        </ul>
                </div>
            </div> 

            

            <!-- Modal -->
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Create a new channel</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="/" method="post" class="m-2 login">
                    
                                <div class="m-2 form-group"> </div>

                                <div class="form-group">
                                    <input id="channel" autocomplete="off" class="form-control" name="channel" placeholder="new channel name" type="text">
                                </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button   type="submit" class="btn btn-primary">Submit</button>
                        </div>
                        </form>
                    </div>
            </div>
            </div>

            <scrip>

            </script>
            {% endif %}

        </div>
    </main> 
     

{% endblock %}
